@using SimpleApp.Shared
@*@using System.Timers*@
@inject SimpleApp.Client.Services.IArrivalTimeService ArrivalTimeService
@inject NavigationManager uriHelper
@using System.Threading;


<div class="col-8 text-left">
    <button class="button1" type="submit" @onclick="@OnStopTimer">Stop Refresh</button>
</div>


<div class="container">
    <h3 class="text-left">Arrival Times at Stop: @stopNumber, At Time: @currentTime</h3>
    <table class="table table-striped table-bordered">
        <thead>
            <tr>
                <th>Route Number</th>
                <th>Arrival Time</th>
                <th>Remaining Time</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var arrival in Arrivals)
            {
                <tr>
                    <td>@arrival.RouteNumber</td>
                    <td>@arrival.ArrivalTime</td>
                    <td>@arrival.RemainingTime</td>
                </tr>
            }
        </tbody>
    </table>
</div>


@code {

    public int stopNumber = 2;
    public static DateTime d = DateTime.Now;
    public TimeSpan currentTime = new TimeSpan(d.Hour, d.Minute, d.Second);

    private List<Arrival> Arrivals = new List<Arrival>();
    private bool timerStarted = false;
    Timer timer;

    protected override void OnInitialized()
    {
        base.OnInitialized();
        {
            //To get all the arrival times.
            //Arrivals = ArrivalTimeService.GetAllArrivalTimes();

            // Get arrival time by stop number and current time.
            Arrivals = ArrivalTimeService.GetArrivalTimeByStopNumberAndCurrentTime(stopNumber, currentTime);

            if (!timerStarted)
            {
                timer = new Timer(new TimerCallback(_ =>
                {
                    uriHelper.NavigateTo(uriHelper.Uri, forceLoad: true);
                }), null, 60000, 60000);
                timerStarted = true;
            }
        }
    }

    protected void OnStopTimer(MouseEventArgs mouseEventArgs)
    {
        timer.Dispose();
    }

}


<style>
    .button1 {
        font-size: 16px;
        font-weight: bold;
        background-color: lightgoldenrodyellow;
        border-color: black;
        color: red;
    }

    .container {
        float: left;
    }
</style>
